version: '3'
services:
  spm-client:
   image: sematext/spm-client:auto-discovery
   #environment:
     #- REGION=EU
     #- INFRA_TOKEN=${INFRA_TOKEN}
   volumes: 
      # spm-client > v1.31.65 requires access to docker socket
      - /var/run/docker.sock:/var/run/docker.sock

  elasticsearch:
   image: amazon/opendistro-for-elasticsearch:latest
   ports:
     - "9200:9200"
   environment:
     #- REGION=EU
     # Tokens from http://apps.sematext.com
     #- SPM_TOKEN=${MONITORING_TOKEN}
     - INFRA_TOKEN=${INFRA_TOKEN}
     - MONITORING_TOKEN=${MONITORING_TOKEN}
     - spm_templates__elasticsearch__spmConfig__SPM_MONITOR_LOGGING_LEVEL=DEBUG
     - spm_templates__elasticsearch__spmConfig__SPM_MONITOR_ES_NODE_BASICAUTH_USERNAME=admin
     - spm_templates__elasticsearch__spmConfig__SPM_MONITOR_ES_NODE_BASICAUTH_PASSWORD=admin
     - spm_templates__elasticsearch__spmConfig__SPM_MONITOR_ES_NODE_HOSTPORT="https://$${host}:$${port}"
     
   volumes:
     # set your data directory and other options ...
     - /tmp/es-data3/:/usr/share/elasticsearch/data
